<div class="dashboard-page">
  <h3 class="title-heading-3">Dashboard</h3>

  <div class="dashboard-content">
    <mat-tab-group>
      <mat-tab label="Default Connection Links">
        <div class="tab-content w-100">
          <div class="header-section">
            <div class="subtitle-medium">Default Connection Links</div>
            <div class="body-smaller-text">Use these pre-configured links to quickly share access requests with your clients</div>
          </div>

          <div class="links-container">
            <mat-card class="link-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon class="card-icon manage-icon">admin_panel_settings</mat-icon>
                  Manage Access Link
                </mat-card-title>
                <mat-card-subtitle>
                  Grant full control to manage campaigns, budgets and assets
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <div class="link-content">
                  <div class="link-field-wrapper">
                    <mat-form-field appearance="outline" class="link-field">
                      <mat-label>Connection Link</mat-label>
                      <input readonly matInput [value]="manageAccessLink()" />
                      <mat-hint>Share this link with clients to grant manage access</mat-hint>
                    </mat-form-field>
                    <button mat-icon-button color="primary"
                            matTooltip="Copy link"
                            class="copy-button"
                            [cdkCopyToClipboard]="manageAccessLink()"
                            (cdkCopyToClipboardCopied)="onCopySuccess()">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>

                  <div class="action-buttons">
                    <button mat-stroked-button
                            (click)="openCustomizeAccessLinkModal(defaultManageLink()!)">
                      <mat-icon>settings</mat-icon>
                      Customize Link
                    </button>

                    <button mat-stroked-button
                            (click)="openInNewTab(manageAccessLink())">
                      <mat-icon>open_in_new</mat-icon>
                      Open in New Tab
                    </button>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <mat-card class="link-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon class="card-icon view-icon">visibility</mat-icon>
                  View Access Link
                </mat-card-title>
                <mat-card-subtitle>
                  View-only access to analytics and reports without editing rights
                </mat-card-subtitle>
              </mat-card-header>

              <mat-card-content>
                <div class="link-content">
                  <div class="link-field-wrapper">
                    <mat-form-field appearance="outline" class="link-field">
                      <mat-label>Connection Link</mat-label>
                      <input readonly matInput [value]="viewAccessLink()" />
                      <mat-hint>Share this link with clients to grant view-only access</mat-hint>
                    </mat-form-field>
                    <button mat-icon-button color="primary"
                            matTooltip="Copy link"
                            class="copy-button"
                            [cdkCopyToClipboard]="viewAccessLink()"
                            (cdkCopyToClipboardCopied)="onCopySuccess()">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>

                  <div class="action-buttons">
                    <button mat-stroked-button
                            (click)="openCustomizeAccessLinkModal(defaultViewLink()!)">
                      <mat-icon>settings</mat-icon>
                      Customize Link
                    </button>

                    <button mat-stroked-button
                            (click)="openInNewTab(viewAccessLink())">
                      <mat-icon>open_in_new</mat-icon>
                      Open in New Tab
                    </button>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>
      <mat-tab label="All Connection Links">
        <div class="tab-content w-100">
          <div class="header-section">
            <div class="subtitle-medium">All Connection Links</div>
            <div class="body-smaller-text">Manage all your connection links including custom configurations for specific clients</div>
          </div>

          <table>
            <thead>
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Default</th>
              <th>Connection Link</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
              @for (link of connectionLinks(); track link._id) {
                <tr>
                  <td>{{ link.name }}</td>
                  <td>
                    <app-badge
                      [text]="link.type === 'view' ? 'View' : 'Manage'"
                      [variant]="link.type === 'view' ? 'info' : 'warning'">
                    </app-badge>
                  </td>
                  <td>
                    @if (link.isDefault) {
                      <mat-icon color="primary">check_circle</mat-icon>
                    } @else {
                      <mat-icon>radio_button_unchecked</mat-icon>
                    }
                  </td>
                  <td>
                    <button mat-icon-button matTooltip="Copy link"
                            [cdkCopyToClipboard]="getConnectionLink(link._id)"
                            (cdkCopyToClipboardCopied)="onCopySuccess()">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                    <button mat-icon-button matTooltip="Open link"
                            (click)="openInNewTab(getConnectionLink(link._id))">
                      <mat-icon>open_in_new</mat-icon>
                    </button>
                  </td>
                  <td>
                    @if (!link.isDefault) {
                      <button mat-icon-button matTooltip="Delete"
                              (click)="deleteConnectionLink(link._id)">
                        <mat-icon>delete</mat-icon>
                      </button>
                      <button mat-icon-button matTooltip="Set as default"
                              (click)="setAsDefaultConnectionLink(link._id)">
                        <mat-icon>star_border</mat-icon>
                      </button>
                    }
                    <button mat-icon-button matTooltip="Customize this link"
                            (click)="openCustomizeAccessLinkModal(link)">
                      <mat-icon>settings</mat-icon>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
          <button mat-flat-button color="primary" (click)="createNewConnectionLink()">
            <mat-icon>add</mat-icon>
            Create New Connection Link
          </button>
        </div>
      </mat-tab>
    </mat-tab-group>

    <mat-tab-group>
      <mat-tab label="Connections History">
        <div class="tab-content w-100">
          <div class="header-section">
            <div class="subtitle-medium">Connections History</div>
            <div class="body-smaller-text">Review past connection attempts and access grants</div>
          </div>
          <div class="filters-panel">
            <mat-form-field appearance="outline">
              <mat-label>Date Range</mat-label>
              <mat-select [value]="selectedDateRange()" (selectionChange)="selectedDateRange.set($event.value); onFilterChange()">
                <mat-option value="all">All Time</mat-option>
                <mat-option value="7days">Last 7 Days</mat-option>
                <mat-option value="30days">Last 30 Days</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Access Type</mat-label>
              <mat-select [value]="selectedAccessType()" (selectionChange)="selectedAccessType.set($event.value); onFilterChange()">
                <mat-option value="all">All</mat-option>
                <mat-option value="view">View Only</mat-option>
                <mat-option value="manage">Manage</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Platform</mat-label>
              <mat-select [value]="selectedPlatform()" (selectionChange)="selectedPlatform.set($event.value); onFilterChange()">
                <mat-option value="all">All Platforms</mat-option>
                <mat-option value="google">Google</mat-option>
                <mat-option value="facebook">Facebook</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <app-connection-results-table [results]="connectionResults()" [isLoading]="isLoadingResults()" />

          <mat-paginator
            [length]="totalResults()"
            [pageSize]="pageSize()"
            [pageIndex]="currentPage() - 1"
            [pageSizeOptions]="[15]"
            (page)="onPageChange($event)"
            aria-label="Select page of connection results">
          </mat-paginator>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
