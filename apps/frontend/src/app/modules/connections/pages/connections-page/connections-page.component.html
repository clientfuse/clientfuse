<div class="connections-container">

  <div class="header-section">
    <h1 class="title-heading-2">
      {{ connectionSettings()?.email }} is requesting access to
      <span class="platforms">{{ requestedPlatformsText() }}</span>
    </h1>
  </div>

  <div class="stepper-section">
    <mat-stepper #stepper
                 [linear]="isLinear()"
                 [selectedIndex]="currentStepIndex()"
                 orientation="horizontal"
                 labelPosition="bottom"
                 class="connection-stepper">

      @for (step of connectionSteps(); track step.id) {
        <mat-step [completed]="step.completed"
                  [editable]="!isLinear() || isStepAccessible($index)"
                  class="connection-step">

          <ng-template matStepLabel>
            {{ step.title }}
          </ng-template>

          @switch (step.id) {

            @case ('connect') {
              <div class="step-content">
                <div class="step-header">
                  <mat-icon class="step-icon">{{ step.icon }}</mat-icon>
                  <h2 class="title-heading-3">{{ step.title }}</h2>
                  <p class="body step-description">{{ step.description }}</p>
                </div>

                <app-connect-accounts [connectionSettings]="connectionSettings()"
                                      [enabledGoogleServicesNames]="enabledGoogleServicesNames()"
                                      [accessType]="accessType()" />

                <div class="step-actions">
                  <button (click)="nextStep()" mat-button>Next</button>
                </div>
              </div>
            }
            @case ('confirm') {
              <div class="step-content">
                <div class="step-header">
                  <mat-icon class="step-icon confirmed">{{ step.icon }}</mat-icon>
                  <h2 class="title-heading-3">{{ step.title }}</h2>
                  <p class="body step-description">Review the permissions you're about to grant</p>
                </div>

                <app-confirm-access />

                <div class="step-actions">
                  <button mat-button (click)="previousStep()" class="button-medium">Back</button>
                  <button mat-button (click)="nextStep()" class="button-medium">Next</button>
                </div>
              </div>
            }
            @case ('connected') {
              <div class="step-content success">
                <div class="step-header">
                  <mat-icon class="step-icon success">{{ step.icon }}</mat-icon>
                  <h2 class="title-heading-3">{{ step.title }}</h2>
                  <p class="body step-description">Successfully connected to all requested accounts</p>
                </div>

                <app-access-outcome />

                <div class="step-actions">
                  <button mat-button (click)="previousStep()" class="button-medium">Back</button>
                </div>
              </div>
            }
          }
        </mat-step>
      }
    </mat-stepper>
  </div>

</div>
