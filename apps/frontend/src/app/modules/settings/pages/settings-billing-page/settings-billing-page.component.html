<div class="settings-content">
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <div class="loading-text">Loading billing information...</div>
    </div>
  } @else {
    <div>
      <div class="subtitle-medium">Plan & Billing</div>

      <div class="settings-content-stack">
        <div class="settings-content-row">
          <div class="settings-content-row-label">Your Plan</div>
          <div class="settings-content-row-value">
            @if (currentPlan(); as plan) {
              {{ plan.name }} ({{ plan.billingPeriod }})
            } @else {
              No active subscription
            }
          </div>
        </div>

        @if (hasActiveSubscription()) {
          <div class="settings-content-row">
            <div class="settings-content-row-label">Status</div>
            <div class="settings-content-row-value">
              {{ subscriptionStatusText() }}
            </div>
          </div>

          <div class="settings-content-row">
            <div class="settings-content-row-label">Current Billing Period</div>
            <div class="settings-content-row-value">
              {{ billingPeriodText() }}
            </div>
          </div>

          <div class="settings-content-row">
            <div class="settings-content-row-label">Manage Subscription</div>
            <div class="settings-content-row-value">
              <button mat-stroked-button (click)="openPortal()">
                Open Customer Portal
              </button>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="billing-period-toggle">
      <div>Monthly</div>
      <mat-slide-toggle [checked]="isAnnual()" (change)="billingPeriodChanged($event)" />
      <div>Annual</div>
    </div>

    <div class="billing-tiers-container">
      @for (plan of selectedPeriodPlans(); track plan._id) {
        <app-tier-card
          [tier]="plan"
          [currentPlanId]="currentPlanId()"
          (selectTier)="onSelectTier($event)"
        />
      }
    </div>
  }
</div>
